<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8"/>
    <title>员工帐号管理</title>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
</head>
<body>
<div id="app">
    <!-- 导航栏 -->
    <div class="navigator">
        <el-breadcrumb separator-class="el-icon-arrow-right" class="pager">
            <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
            <el-breadcrumb-item>员工帐号管理</el-breadcrumb-item>
        </el-breadcrumb>
        <!-- 搜索功能 -->
        <el-select size="small" v-model="status">
            <el-option label="帐号状态" value="-1"></el-option>
            <el-option v-for="item in enums.status" :key="item.value" :value="item.value" :label="item.name"></el-option>
        </el-select>
        <el-input size="small" placeholder="请输入内容" v-model="searchText" class="input-with-select">
            <el-select v-model="searchType" slot="prepend">
                <el-option label="搜索类型" value="-1"></el-option>
                <el-option label="帐号ID" value="1"></el-option>
                <el-option label="帐号名" value="2"></el-option>
                <el-option label="帐号昵称" value="3"></el-option>
            </el-select>
            <el-button @click="btnSearchClick" slot="append" icon="el-icon-search"></el-button>
        </el-input>
        <div class="fr">
            <el-button size="small" icon="el-icon-plus" v-if="editQualify" @click="showInsertDialog"></el-button>
            <el-button size="small" @click="search" icon="el-icon-refresh"></el-button>
        </div>
    </div>
    <!-- 表格 -->
    <el-table :data="tableData" :border="true" v-loading="loading" element-loading-text="拼命加载中" element-loading-spinner="el-icon-loading" size="mini">
        <el-table-column prop="id" label="帐号ID"></el-table-column>
        <el-table-column prop="name" label="帐号名称"></el-table-column>
        <el-table-column prop="alias" label="昵称">
            <template slot-scope="scope">
                <img :src="scope.row.avatar" style="float: left; margin-right: 5px; max-width: 30px; max-height: 30px"/>
                <label>{{scope.row.alias}}</label>
            </template>
        </el-table-column>
        <el-table-column prop="type" label="类型">
            <template slot-scope="scope">{{ enums.staffType.getName(scope.row.type) }}</template>
        </el-table-column>
        <el-table-column prop="platform" label="平台">
            <template slot-scope="scope">{{ enums.platform.getName(scope.row.platform) }}</template>
        </el-table-column>
        <el-table-column prop="status" label="状态">
            <template slot-scope="scope">
                <label :class="scope.row.status == enums.status.ENABLE.value ? '' : 'red'">{{ enums.status.getName(scope.row.status) }}</label>
            </template>
        </el-table-column>
        <el-table-column label="操作" v-if="editQualify || permissionQualify">
            <template slot-scope="scope">
                <el-button-group>
                    <el-button size="mini" v-if="editQualify" @click="toEdit(scope.row)" icon="el-icon-edit"></el-button>
                    <el-button size="mini" v-if="permissionQualify" @click="toPermission(scope.row)" icon="el-icon-set-up"></el-button>
                </el-button-group>
            </template>
        </el-table-column>
    </el-table>
    <el-pagination slot="paging" class="pager" layout="total, prev, pager, next" :total="rowCount" :page-size="15" :current-page="page" @current-change="pageChanged"></el-pagination>
    <!-- 添加删除帐号 -->
    <el-dialog :title="dialogTitle" :visible.sync="dialogEnabled" width="480px">
        <el-form ref="staff" :model="staff" label-width="80px">
            <el-form-item prop="name" label="帐号名称" :rules="[{ required: true, message: '请填写帐号名称', trigger: 'blur' }]">
                <el-input v-model="staff.name" :disabled="username_disabled"></el-input>
            </el-form-item>
            <el-form-item prop="password" label="帐号密码">
                <el-input v-model="staff.password" show-password></el-input>
            </el-form-item>
            <el-form-item prop="alias" label="帐号昵称" :rules="[{ required: true, message: '请填写帐号昵称', trigger: 'blur' }]">
                <el-input v-model="staff.alias"></el-input>
            </el-form-item>
            <el-form-item prop="alias" label="帐号头像">
                <el-upload class="avatar-uploader" action="" :show-file-list="false" :before-upload="beforeUpload">
                    <img v-if="staff.avatar" :src="staff.avatar" style="max-width: 100px; max-height: 100px">
                    <i v-else class="el-icon-plus avatar-uploader-icon"></i>
                </el-upload>
            </el-form-item>
            <el-form-item prop="type" label="帐号类型" :rules="[{ required: true, message: '请选择帐号类型', trigger: 'change' }]">
                <el-select v-model="staff.type" placeholder="请选择帐号类型">
                    <el-option v-for="item in enums.staffType" :label="item.name" :key="item.value" :value="item.value"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item prop="platform" label="平台" :rules="[{ required: true, message: '请选择平台', trigger: 'change' }]">
                <el-select v-model="staff.platform" placeholder="请选择平台">
                    <el-option v-for="item in enums.platform" :label="item.name" :key="item.value" :value="item.value"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item prop="status" label="状态" :rules="[{ required: true, message: '请选择状态', trigger: 'change' }]">
                <el-radio-group v-model="staff.status">
                    <el-radio-button v-for="item in enums.status" :label="item.value" :key="item.value">{{item.name}}</el-radio-button>
                </el-radio-group>
            </el-form-item>
        </el-form>
        <span slot="footer" class="dialog-footer">
            <el-button @click="onCancel('staff')">取 消</el-button>
            <el-button type="primary" @click="onSubmit('staff')">确 定</el-button>
        </span>
    </el-dialog>
</div>
<!-- 设置权限 -->
<div id="permission">
    <el-dialog :title="dialogTitle" :visible.sync="dialogEnabled" width="480px">
        <el-tree :data="data" show-checkbox default-expand-all node-key="id" ref="treeviewer" highlight-current></el-tree>
        <span slot="footer" class="dialog-footer">
            <el-button @click="dialogEnabled=false">取 消</el-button>
            <el-button type="primary" @click="onSubmit('staff')">确 定</el-button>
        </span>
    </el-dialog>
</div>
<script src="/js/core.js"></script>
<script src="/js/md5.js"></script>
<script src="/js/oa/staff.js"></script>
</body>
</html>